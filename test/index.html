<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <!-- Ensures mobile-friendly scaling -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <title>Home - Droits & Obligations</title>

    <style>
        /****************************************************
         * 1) GLOBAL STYLES / RESET
         ****************************************************/
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                         Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            background-color: #f4f4f4;
            color: #333;
            line-height: 1.5;
            text-align: center;
            padding: 20px;
        }

        img {
            max-width: 100%;
            display: block;
        }

        /****************************************************
         * 2) INTRO SECTION (HOME SCREEN)
         ****************************************************/
        .container {
            max-width: 900px;
            margin: 40px auto;
            background: #fff;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.05);
            text-align: center;
        }

        .logo {
            width: 200px;
            margin: 0 auto 20px;
        }

        h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        p {
            font-size: 17px;
            color: #555;
            margin-bottom: 16px;
        }

        .start-button {
            display: inline-block;
            padding: 12px 24px;
            font-size: 16px;
            color: #fff;
            background-color: #006233; /* brand green accent */
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .start-button:hover {
            background-color: #004d1a;
        }

        .section {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            text-align: left;
        }
        .section h2 {
            font-size: 22px;
            margin-bottom: 12px;
            color: #333;
        }
        .section p {
            color: #555;
            font-size: 16px;
            margin-bottom: 16px;
        }
        .values-container {
            text-align: center;
        }
        .values-container img {
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        /****************************************************
         * 3) EXPLORER SCREEN
         ****************************************************/
        #explorer-screen {
            display: none; /* hidden until user clicks "Explorer" */
            max-width: 900px;
            margin: 40px auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.05);
            padding: 40px;
            text-align: left;
        }

        .header-explorer {
            text-align: center;
            position: relative;
            margin-bottom: 20px;
        }
        .logo-explorer {
            width: 180px;
            margin: 0 auto 4px;
        }

        /* A subtle horizontal rule with gradient for extra flair */
        .stylish-separator {
            border: 0;
            height: 1px;
            width: 100%;
            background: linear-gradient(to right, transparent, #ccc, transparent);
            margin: 16px 0 30px;
        }

        .back-button {
            display: inline-block;
            margin-top: 8px;
            padding: 8px 16px;
            background: #f2f2f2;
            border: none;
            border-radius: 8px;
            color: #333;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s;
        }
        .back-button:hover {
            background-color: #e0e0e0;
        }
        .back-button:active {
            transform: scale(0.97);
        }

        /* Basic headings for steps */
        .step-heading {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
            text-align: center;
        }
        .step-subtitle {
            font-size: 15px;
            color: #777;
            text-align: center;
            margin-bottom: 20px;
        }

        /****************************************************
         * 4) LISTS & CARDS FOR CLUSTERS, RIGHTS, OBLIGATIONS
         ****************************************************/
        ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        li {
            margin-bottom: 16px;
        }

        .card {
            background: #fff;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.07);
        }
        .card h3 {
            font-size: 16px;
            color: #333;
            margin-bottom: 6px;
        }
        .card p {
            margin: 0;
            font-size: 14px;
            color: #666;
        }

        /* Collapsible obligations details */
        .obligation-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .obligation-toggle h3 {
            margin: 0;
            font-size: 16px;
            color: #333;
        }
        .obligation-content {
            display: none;
            margin-top: 12px;
            font-size: 14px;
            color: #444;
        }
        .obligation-content.active {
            display: block;
        }

        /****************************************************
         * 5) RESPONSIVENESS
         ****************************************************/
        @media (max-width: 768px) {
            .container, #explorer-screen {
                margin: 20px auto;
                padding: 20px;
            }
            .logo {
                width: 160px;
            }
            h1 {
                font-size: 24px;
            }
            .section h2 {
                font-size: 18px;
            }
            .logo-explorer {
                width: 140px;
            }
            .card {
                margin: 0 0 16px;
            }
        }

    </style>
</head>
<body>

    <!-- =========================================
         (A) INTRO SECTION (HOME SCREEN)
         ========================================= -->
    <div class="container" id="intro-container">
        <img src="Logo_Ocre.png" alt="Organisation Logo" class="logo">
        <h1>Bienvenue sur la plateforme Droits & Obligations</h1>
        <p>
            Cette plateforme vise à fournir une meilleure compréhension des liens entre
            les <strong>droits</strong> et les <strong>obligations</strong> au sein du cadre légal marocain.
            Découvrez comment chaque obligation permet d’accéder à certains droits et explorez les références légales correspondantes.
        </p>

        <!-- The "Explore" button leads to the Explorer Screen -->
        <button class="start-button" onclick="showExplorer()">Explorer</button>

        <!-- Qui sommes-nous? -->
        <div class="section">
            <h2>Qui sommes-nous ?</h2>
            <p>
                <strong>OSSAM</strong> est une initiative portée par des jeunes Marocains visant à
                <strong>reconnecter la science, l'éducation et l'art</strong> pour façonner un avenir
                meilleur pour <strong>notre pays</strong>. En mettant en avant un
                <strong>référentiel de valeurs solide</strong>, OSSAM agit pour un
                <strong>Maroc</strong> où savoir et créativité sont au service du développement.
            </p>
        </div>

        <!-- Nos valeurs -->
        <div class="section">
            <h2>Nos valeurs</h2>
            <div class="values-container">
                <img src="values.png" alt="Nos Valeurs">
            </div>
        </div>
    </div>

    <!-- =========================================
         (B) EXPLORER SCREEN
         ========================================= -->
    <div id="explorer-screen">
        <div class="header-explorer">
            <!-- Main logo in explorer -->
            <img src="Logo_Ocre.png" alt="Logo" class="logo-explorer">
            <!-- Back button to exit explorer -->
            <button class="back-button" onclick="hideExplorer()">← Retour</button>

            <!-- Subtle line for visual separation -->
            <hr class="stylish-separator">

            <h2 style="margin-top: 0; text-align:center;">Explorer : Droits & Obligations</h2>
        </div>

        <!-- Step 1: CLUSTERS -->
        <div id="clusters-view">
            <h2 class="step-heading">Étape 1 : Choisir un Cluster</h2>
            <p class="step-subtitle">Sélectionnez un domaine pour voir les droits associés.</p>
            <ul id="clusters-list"></ul>
        </div>

        <!-- Step 2: RIGHTS -->
        <div id="rights-view" style="display:none;">
            <button class="back-button" onclick="goBackToClusters()" style="margin-bottom:20px;">← Retour Clusters</button>
            <h2 class="step-heading">Étape 2 : Choisir un Droit</h2>
            <p class="step-subtitle">Dans le cluster <span id="current-cluster"></span></p>
            <ul id="rights-list"></ul>
        </div>

        <!-- Step 3: OBLIGATIONS -->
        <div id="obligations-view" style="display:none;">
            <button class="back-button" onclick="goBackToRights()" style="margin-bottom:20px;">← Retour Droits</button>
            <h2 class="step-heading">Étape 3 : Consulter les Obligations</h2>
            <p class="step-subtitle">Liées au droit <span id="current-right"></span></p>
            <ul id="obligations-list"></ul>
        </div>
    </div>

    <script>
        /*************************************************
         * GLOBAL: Storing data & current selection
         *************************************************/
        let rawData = [];
        let currentCluster = null;
        let currentRight = null;

        /*************************************************
         * On Page Load: fetch data, show clusters
         *************************************************/
        window.addEventListener('DOMContentLoaded', init);
        async function init() {
            // The same data your Sankey used
            rawData = await fetch('data/output.json').then(r => r.json());
            showClusters();
        }

        /*************************************************
         * Show / Hide Explorer
         *************************************************/
        function showExplorer() {
            document.getElementById('intro-container').style.display = 'none';
            document.getElementById('explorer-screen').style.display = 'block';
        }
        function hideExplorer() {
            document.getElementById('explorer-screen').style.display = 'none';
            document.getElementById('intro-container').style.display = 'block';
        }

        /*************************************************
         * 1) Show Clusters (Step 1)
         *************************************************/
        function showClusters() {
            document.getElementById('clusters-view').style.display = 'block';
            document.getElementById('rights-view').style.display = 'none';
            document.getElementById('obligations-view').style.display = 'none';

            const clustersUl = document.getElementById('clusters-list');
            clustersUl.innerHTML = '';

            // Distinct cluster names
            const clusters = Array.from(new Set(rawData.map(d => d.cluster)));

            clusters.forEach(cluster => {
                const li = document.createElement('li');
                const div = document.createElement('div');
                div.classList.add('card');
                div.innerHTML = `<h3>${cluster}</h3>`;
                div.onclick = () => showRights(cluster);
                li.appendChild(div);
                clustersUl.appendChild(li);
            });
        }

        /*************************************************
         * 2) Show Rights for chosen cluster (Step 2)
         *************************************************/
        function showRights(cluster) {
            currentCluster = cluster;
            document.getElementById('clusters-view').style.display = 'none';
            document.getElementById('rights-view').style.display = 'block';
            document.getElementById('obligations-view').style.display = 'none';

            document.getElementById('current-cluster').textContent = cluster;

            const rightsUl = document.getElementById('rights-list');
            rightsUl.innerHTML = '';

            const filtered = rawData.filter(d => d.cluster === cluster);

            filtered.forEach(item => {
                const li = document.createElement('li');
                const div = document.createElement('div');
                div.classList.add('card');
                div.innerHTML = `
                    <h3>${item.right}</h3>
                    <p>${item.lawRef}</p>
                `;
                div.onclick = () => showObligations(item.right);
                li.appendChild(div);
                rightsUl.appendChild(li);
            });
        }
        function goBackToClusters() {
            showClusters();
        }

        /*************************************************
         * 3) Show Obligations for chosen right (Step 3)
         *************************************************/
        function showObligations(rightName) {
            currentRight = rightName;
            document.getElementById('clusters-view').style.display = 'none';
            document.getElementById('rights-view').style.display = 'none';
            document.getElementById('obligations-view').style.display = 'block';

            document.getElementById('current-right').textContent = rightName;

            const obligationsUl = document.getElementById('obligations-list');
            obligationsUl.innerHTML = '';

            const item = rawData.find(d => d.cluster === currentCluster && d.right === rightName);
            if (!item) {
                obligationsUl.innerHTML = `<li>Aucune obligation trouvée.</li>`;
                return;
            }

            item.obligations.forEach(ob => {
                const li = document.createElement('li');
                const card = document.createElement('div');
                card.classList.add('card');
                card.innerHTML = `
                    <div class="obligation-toggle">
                        <h3>${ob.name}</h3>
                        <span>▼</span>
                    </div>
                    <div class="obligation-content">
                        <p><strong>Référence légale :</strong><br>${ob.lawRef}</p>
                    </div>
                `;
                // Collapsible toggle
                const toggle = card.querySelector('.obligation-toggle');
                const content = card.querySelector('.obligation-content');
                toggle.addEventListener('click', () => {
                    content.classList.toggle('active');
                });

                li.appendChild(card);
                obligationsUl.appendChild(li);
            });
        }
        function goBackToRights() {
            showRights(currentCluster);
        }
    </script>
</body>
</html>
